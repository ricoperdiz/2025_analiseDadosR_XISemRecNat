---
encoding: "UTF-8"
title: "Oficina 'Introdu√ß√£o √† an√°lise explorat√≥ria de dados em ambiente R'"

subtitle: "XI Semin√°rio de Recursos Naturais | PRONAT UFRR | 2025"

date: "05 Nov 2025"

format:
  live-html:
    toc: true
    theme: 
      light: cerulean
      dark: solar

resources:
  - penguins.csv
  - penguins.xlsx

engine: knitr

webr:
  packages:
    - dplyr
    - palmerpenguins
    - ggplot2
  repos:
    - https://r-lib.r-universe.dev
---

{{< include ./_extensions/r-wasm/live/_knitr.qmd >}}


::: {.callout-note}
## Dados da oficina

Baixe aqui:

* [penguins.csv](https://drive.google.com/file/d/1XjPPL6H0GHlY5DOWd3d8xbjoxYGZOC6Q/view?usp=drive_link)

* [penguins.xlsx](https://docs.google.com/spreadsheets/d/1L_WgbuCYN_4dS4Jcol3_HptVKyRDTKNC/edit?usp=drive_link&ouid=107115676585048825053&rtpof=true&sd=true)

:::

<!-- ::: {.callout-note} -->
<!-- ## Informes -->

<!-- √öltima atualiza√ß√£o: `r lubridate::today()`.   -->

<!-- C√≥digo fonte: <https://github.com/ricoperdiz/2025_analiseDadosR_XISemRecNat>.   -->

<!-- ### Adi√ß√µes -->

<!-- N√£o se aplica.   -->

<!-- ::: -->

## Apresenta√ß√£o da oficina

O objetivo desta oficina √© introduzir o uso da linguagem **R** e do ambiente **RStudio** para an√°lise explorat√≥ria de dados, com foco em aplica√ß√µes nas **Ci√™ncias ambientais**.  
Ao final desta oficina, voc√™ ter√° os conhecimentos b√°sicos para importar, manipular, agrupar e contar, e visualizar dados simples em R.  

Durante as oito horas de oficina, apresentaremos resumidamente comandos b√°sicos em R que cobrem quase todo o ciclo da an√°lise de dados (@fig-analisedados).
Nosso intuito √© demonstrar o poder do R enquanto ferramenta para a an√°lise de dados.
Oferecemos ent√£o uma introdu√ß√£o √† importa√ß√£o de dados, checagem e transforma√ß√£o de dados, manipula√ß√£o de dados, agrupamento e sumariza√ß√£o de dados, e, por fim, visualiza√ß√£o de dados.  


```{r}
#| label: fig-analisedados
#| fig-cap: "Ciclo da an√°lise de dados. Neste  curso, n√£o abordaremos a modelagem de dados. Fonte: Curso-R, dispon√≠vel em <https://livro.curso-r.com/assets/img/manipulacao/ciclo-ciencia-de-dados.png>."
#| echo: false
knitr::include_graphics(
  "https://livro.curso-r.com/assets/img/manipulacao/ciclo-ciencia-de-dados.png"
)
```

---

## O que √© o R?

**R** √© uma linguagem de programa√ß√£o e um ambiente de software livre voltado √† **an√°lise estat√≠stica**, **explora√ß√£o** e **visualiza√ß√£o de dados** [@IhakaGentleman1996].  
Criado por **Ross Ihaka** e **Robert Gentleman**, o R √© amplamente utilizado por estat√≠sticos, cientistas de dados e pesquisadores para **organizar**, **analisar** e **interpretar** grandes volumes de informa√ß√£o de forma eficiente e reprodut√≠vel [@WickhamGrolemund2017].  

---

## Por que **R**?

{{< revealjs "por-que-r.html" >}}

------------------------------------------------------------------------

## O IDE RStudio

O **RStudio** √© um [ambiente de desenvolvimento integrado (IDE)](https://intror.netlify.app/caso-voc%C3%AA-possua-um-computador.html#instale-um-ambiente-de-desenvolvimento-integrado---ide), que facilita o uso do R.
Ele √© dividido em quatro pain√©is principais:

1. **Script (Editor)** ‚Äì onde escrevemos e salvamos c√≥digos;  
2. **Console** ‚Äì onde os comandos s√£o executados;  
3. **Ambiente** ‚Äì mostra objetos carregados na sess√£o;  
4. **Arquivos, plots e pacotes** ‚Äì onde gerenciamos pastas, gr√°ficos e extens√µes.

::: callout-note
**Dica:**  
Use o atalho `Ctrl + Enter` (ou `Cmd + Enter` no macOS) para executar uma linha de c√≥digo selecionada.
:::

---

## üî∞ B√°sico em R

### Primeiros comandos

O R pode ser usado como uma **calculadora interativa**.  
Experimente no console:

```{webr}
# Opera√ß√µes matem√°ticas simples
2 + 3
10 - 4
5 * 8
12 / 3
2^5
sqrt(49)
log(10)
```

---

### Objetos e atribui√ß√£o

No R, os dados s√£o armazenados em **objetos**.
Usamos `<-` (ou `=`) para atribuir valores.

```{webr}
# Criando objetos
altura <- 1.75
peso <- 68

# C√°lculo com objetos
imc <- peso / (altura^2)
imc
```

::: callout-note
**Boa pr√°tica:**
Use nomes curtos e descritivos (sem acentos ou espa√ßos), como `dados_plantas` ou `taxa_crescimento`.  
:::

Podemos fazer opera√ß√µes matem√°ticas e guardar resultado das opera√ß√µes em objetos.  

```{webr}
# Opera√ß√µes b√°sicas
soma <- x + y
soma
```

```{webr}
subtracao <- x - y
subtracao
```


```{webr}
multiplicacao <- x * y
multiplicacao
```

```{webr}
divisao <- x/y
divisao
```

### Ver o conte√∫do de um objeto

Para ver o conte√∫do de um objeto, basta digitar seu nome e rodar o c√≥digo.
Por exemplo, para ver a soma, que est√° no objeto `soma`, fazemos assim:

```{webr}
soma
```


### Concatenando elementos com a fun√ß√£o `c()`

Podemos concatenar elementos utilizando a fun√ß√£o `c()`.
Chamamos esse conjunto de elementos de vetores:

```{webr}
# Vetores: cole√ß√µes de elementos do mesmo tipo
numeros <- c(1, 2, 3, 4, 5)
numeros
letras <- c("a", "b", "c")
letras
```

Acima, criamos os vetores `numeros` e `letras`.
Reparem que em letras adicionamos letras do alfabeto entre aspas `""`.
*Devemos fazer isso toda vez que desejarmos __guardar texto__ em um objeto*.  

---

### Tipos de dados e vetores

Os vetores s√£o as estruturas b√°sicas do R.
Podem conter **n√∫meros**, **caracteres** ou **valores l√≥gicos**.

```{webr}
# Vetores num√©ricos
comprimento <- c(12.4, 15.2, 13.5, 16.1)

# Vetores de texto
especies <- c("Protium", "Bursera", "Dacryodes", "Trattinnickia")

# Vetores l√≥gicos
amostrado <- c(TRUE, FALSE, TRUE, TRUE)

# Consultando estrutura
str(especies)
length(comprimento)
```

---

### Estruturas de dados em R

| Estrutura  | Descri√ß√£o                              | Exemplo        |
| ---------- | -------------------------------------- | -------------- |
| Vetor      | Sequ√™ncia unidimensional               | `c(1,2,3)`     |
| Matriz     | Tabela num√©rica bidimensional          | `matrix()`     |
| Data frame | Tabela com colunas de tipos diferentes | `data.frame()` |
| Lista      | Conjunto heterog√™neo de objetos        | `list()`       |


Podemos criar tabelas, por exemplo.
No R, chamamos tabelas de `data.frame`.
Cada coluna precisa ser um vetor (criado com a fun√ß√£o `c()`). A fun√ß√£o `data.frame()` junta esses vetores, criando uma tabela.  

Em nosso exemplo exposto abaixo, os argumentos `ID`, `Nome` e `Idade` representam os nomes das colunas de nossa tabela, guardada no objeto `dados_exemplo`:

```{webr}
# `dataframe`s: tabelas com linhas e colunas
dados_exemplo <- 
  data.frame(
  ID = c(1, 2, 3),
  Nome = c("Jo√£o", "Maria", "Pedro"),
  Idade = c(25, 30, 22)
)

# Visualizando o `dataframe`
dados_exemplo
```

Podemos ver o conte√∫do de `dados_exemplo` tamb√©m simplesmente executando o nome do objeto:

```{webr}
dados_exemplo
```

### Exemplo 2 de cria√ß√£o de um *data.frame*:

```{webr}
dados <- data.frame(
  especie = especies,
  comprimento = comprimento,
  amostrado = amostrado
)

dados
```

---

### Acessando elementos

Podemos acessar elementos com colchetes `[]` ou pelo nome da coluna.

```{webr}
# Primeira linha
dados[1, ]

# Segunda coluna
dados[, 2]

# Coluna 'especie'
dados$especie

# Selecionando a coluna pelo nome utilizando a fun√ß√£o select() do pacote `dplyr`
select(dados, especie)
```

---

### Pacotes e fun√ß√µes

O R possui milhares de **pacotes** que estendem suas funcionalidades.
Pacotes em R s√£o conjuntos de fun√ß√µes ou conjuntos de dados.
Utilizamos a fun√ß√£o `install.packages()` para instalar esses pacotes.
Neste curso, faremos uso dos pacotes `dplyr` [@dplyr], `palmerpenguins` [@Horstetal2020], `readxl` [@readxl] e `ggplot2` [@Wickham2016].
Primeiro, devemos instalar os pacotes.
Em seguida, carregamos os pacotes de interesse para nossos objetivos.  

::: {.callout-important}
#### `install.packages()` VS. `library()`

Instalamos pacotes R **uma vez apenas**, para cada vers√£o de R que tivermos instalado no computador.
Por outro lado, a cada sess√£o nova de R, devemos carregar os pacotes utilizando a fun√ß√£o `library()`, de forma que as fun√ß√µes dos pacotes estejam dispon√≠veis na sess√£o.  

A fun√ß√£o `install.packages()` √© como instalar um aplicativo no seu celular: voc√™ faz uma vez. O library() √© como abrir esse aplicativo para us√°-lo: voc√™ precisa fazer isso em cada nova sess√£o que iniciar.
:::

O pacote `dplyr` inaugurou uma nova sintaxe em R (ver a postagem [O que √© o Tidyverse](https://www.ricardoperdiz.com/blog/2020-04-tidyverse/) para mais informa√ß√µes), que permite a manipula√ß√£o de dados tabulares de maneira mais pr√°tica e com mais clareza ao usu√°rio.  

O `ggplot2` [@Wickham2016] √© a ferramenta de visualiza√ß√£o mais popular em R e ser√° utilizada neste minicurso.
Ele segue uma "gram√°tica de gr√°ficos", em que voc√™ constr√≥i o gr√°fico em camadas.  

O pacote `readxl` [@readxl] √© usado para importar planilhas `.xls` e `.xlsx` diretamente no R, sem precisar ter programas como o *Excel/LibreOffice Calc* instalados e sem depender de outras ferramentas externas.
√â amplamente utilizado para trazer dados tabulares para dentro do R de forma r√°pida e pr√°tica, preservando nomes de colunas e tipos de vari√°veis.  

Por sua vez, o pacote `palmerpenguins` [@Horstetal2020] oferece um conjunto de dados referente √† morfologia de tr√™s esp√©cies de pinguins que ocorrem no [arquip√©lago de Palmer](https://en.wikipedia.org/wiki/Palmer_Archipelago) no noroeste da [pen√≠nsula Ant√°rtica](https://pt.wikipedia.org/wiki/Pen%C3%ADnsula_Ant%C3%A1rtica).  


```{r}
#| eval: false
#| echo: true
# Instalar (executar uma √∫nica vez)
install.packages("dplyr")
install.packages("ggplot2")
install.packages("palmerpenguins")
install.packages("readxl")
```

Agora carregaremos o pacote por meio da fun√ß√£o `library()`.
Devemos inserir o nome do pacote que queremos carregar entre os par√™nteses, com ou sem aspas.  

```{r}
#| eval: false
#| echo: true
# Carregar
library("dplyr")
library("ggplot2")
library("palmerpenguins")
library("readxl")
```

Fun√ß√µes t√™m o formato `nome(argumentos)`.  

```{webr}
mean(dados$comprimento)
sd(dados$comprimento)
summary(dados$comprimento)
```

---

## üß≥ Importando dados üé≤

<!-- Importa√ß√£o ‚Üí 15 min -->

Para a an√°lise de dados, precisamos carregar __dados__ üòÑüòÑüòÑ.
Existem diversas maneiras de importar dados ao R.
Importaremos um arquivo CSV referente ao pacote R `palmerpenguins` [@Horstetal2020].  

```{webr}
pinguins <- 
  read.table("penguins.csv", sep = "\t", dec = ".", header = TRUE)
pinguins
```


Podemos ler arquivos `xlsx` utilizando a fun√ß√£o `read_excel()` do pacote `readxl` [@readxl]:

```{webr}
pinguins <- 
  read_excel("penguins.xlsx")
pinguins
```


### Resultado da leitura de dados usando `read.table()`


Quando executamos os dados lidos pela fun√ß√£o `read.table()`, podemos acabar vendo muita coisa, o que pode acabar incomodando.
Desta forma, pode-se utilizar a fun√ß√£o `head()` para ver apenas as primeiras seis linhas da tabela.  


```{r}
#| include: false
#| eval: false
pinguins <- read.table(
  "penguins.csv",
  sep = "\t",
  dec = ".",
  header = TRUE
)
head(pinguins)
```


::: {.callout-tip}
#### Diferen√ßa entre `read.csv()` e `read.table()`

O R possui diferentes fun√ß√µes para ler tabelas:

+ `read.csv()` √© uma forma simplificada de read.table() j√° configurada para ler arquivos separados por v√≠rgula (,) e com ponto (.) como separador decimal.

+ `read.table()` √© mais flex√≠vel, permitindo ajustar separador (`sep`) e s√≠mbolo decimal (`dec`).  
:::


### Inspe√ß√£o b√°sica - `head()`, `tail()`, `str()`, `summary()` e `glimpse()` {#sec-inspecaobasica}

<!-- inspe√ß√£o de dados ‚Üí 25 min -->

Agora que os dados foram lidos, vamos inspecion√°-los.
Para ver as primeiras linhas/valores de um objeto, utilizamos a fun√ß√£o `head()`:

```{webr}
# Inspecionando os dados
head(pinguins)   # Primeiras 6 linhas
```

Para observar os √∫ltimos valores, utilizamos a fun√ß√£o `tail()`:

```{webr}
tail(pinguins)   # √öltimas 6 linhas
```

Podemos utilizar a fun√ß√£o `dplyr::glimpse()` para ver a estrutura dos dados:

```{webr}
glimpse(pinguins) # Uma vis√£o geral dos dados
```

Al√©m de `dplyr::glimpse()`, duas fun√ß√µes muito √∫teis para inspecionar dados s√£o:

+ `str()`: mostra a estrutura do objeto.

+ `summary():` gera um resumo estat√≠stico das vari√°veis num√©ricas e uma contagem das categorias.  

```{webr}
str(pinguins)
summary(pinguins)
```


------------------------------------------------------------------------


## üßπ Limpeza e checagem de dados üëÄ

Dados do mundo real raramente s√£o perfeitos.
Precisamos limp√°-los.  

+ **Dados ausentes (NA):** Verificando e lidando com valores `NA`.  

+ **Tipos de colunas:** Garantindo que cada coluna tenha o tipo de dado correto (num√©rico, texto, etc.).  

### Dados ausentes

```{webr}
# Identificando valores ausentes
sum(is.na(pinguins))
```

### Removendo linhas com NA

Para remover todas as linhas que apresentarem valoes ausentes, podemos utilizar a fun√ß√£o `na.omit()`.  

```{webr}
dados_sem_na <- na.omit(pinguins)
```

Agora checamos os dados ap√≥s a remo√ß√£o das linhas com dados ausentes:

```{webr}
glimpse(dados_sem_na)
```

### Renomear colunas

Podemos renomear colunas utilizando a fun√ß√£o `dplyr::rename()`:

```{webr}
# Renomeando colunas para nomes em portugues
pinguins_renomeados <- 
  rename(
    pinguins,
    barbatana_comprimento_mm = flipper_length_mm,
    massa_corporal_g = body_mass_g
  )
```

Veja agora o resultado da renomea√ß√£o das colunas:

```{webr}
glimpse(pinguins_renomeados)
```

### Transforma√ß√£o de tipos de dados/colunas

√Äs vezes, uma coluna que deveria ser num√©rica (por exemplo, com n√∫meros) √© lida como um texto.
Isso pode acontecer quando a coluna tem algum valor n√£o num√©rico, como um caractere especial ou um espa√ßo.  

Para resolver, podemos converter o tipo de dado.
Por exemplo, vamos transformar a coluna `body_mass_g` para o tipo num√©rico usando a fun√ß√£o `as.numeric()`:

```{webr}
# Transformando uma coluna para num√©rica
pinguins$body_mass_g <- as.numeric(pinguins$body_mass_g)
glimpse(pinguins) # Agora veja que a coluna est√° como 'num√©rica'
```

::: {.callout-tip}
### Ajuda para entender quais s√£o os argumentos de uma fun√ß√£o

O R possui uma fun√ß√£o, chamada ajuda "*help*", que deve ser utilizada para obtermos informa√ß√£o sobre o que uma fun√ß√£o executa.
Para obter essa ajuda, devemos pegar a fun√ß√£o e execut√°-la da seguinte forma:

```{r}
#| eval: false
#| echo: true
?read.table
?na.omit
?c
```

Ao utilizar o `?` junto ao nome de uma fun√ß√£o, sem os par√™nteses, uma janela se abre contendo v√°rias informa√ß√µes √∫teis referentes ao que aquela determinada fun√ß√£o faz. Teste a√≠!
:::

## üß© Exerc√≠cios Pr√°ticos ‚Äî Parte I

### 1. Criando e manipulando vetores

1. Crie um vetor chamado `alturas` com os valores `1.60`, `1.72`, `1.80`, `1.65` e `1.75`.
2. Calcule a **m√©dia** das alturas utilizando a fun√ß√£o `mean()`.
3. Calcule o **desvio-padr√£o** com `sd()`.
4. Some `0.05` a cada valor do vetor, simulando um aumento de 5 cm, e guarde o resultado em um novo vetor chamado `alturas_ajustadas`.
5. Compare os dois vetores (`alturas` e `alturas_ajustadas`) no console.

```{webr}
alturas
```

---

### 2. Trabalhando com vetores de texto e l√≥gicos

1. Crie um vetor chamado `nomes` com os valores `"Ana"`, `"Bruno"`, `"Carlos"`, `"Daniela"`, `"Eduardo"`.
2. Crie um vetor l√≥gico chamado `presente` com os valores `TRUE`, `FALSE`, `TRUE`, `TRUE`, `FALSE`.
3. Verifique **quantos** alunos estavam presentes com `sum(presente)`.
4. Use a fun√ß√£o `length()` para contar quantos nomes h√° no vetor.

```{webr}
nomes
```

---

### 3. Construindo seu primeiro `data.frame`

1. Use os vetores `nomes`, `alturas` e `presente` para criar um `data.frame` chamado `dados_alunos`.
2. Visualize a tabela no console.
3. Verifique a estrutura do objeto com `str()`.
4. Use a fun√ß√£o `summary()` para gerar um resumo estat√≠stico das colunas num√©ricas.

```{webr}
dados_alunos
```

---

### 4. Acessando elementos da tabela

1. Mostre apenas a **primeira linha** da tabela.
2. Mostre apenas a coluna `alturas`.
3. Selecione as linhas dos alunos **presentes** (`TRUE`).
4. Mostre apenas os nomes (`nomes`) dos alunos **com altura maior que 1.70 m**.

```{webr}
tabela
```

---

### 5. Explorando fun√ß√µes novas

1. Use `head()` para ver as primeiras linhas da tabela `dados_alunos`.
2. Use `glimpse()` para uma vis√£o geral.
3. Use `nrow()` e `ncol()` para descobrir quantas linhas e colunas h√°.
4. Tente ordenar o `data.frame` pela coluna `alturas`, do menor para o maior, usando a fun√ß√£o `arrange()` do pacote `dplyr`.

```{webr}
dados_alunos
```

---

### 6. Mini-desafio üéØ

Crie um pequeno conjunto de dados fict√≠cio sobre **plantas amostradas em campo**.
Inclua as colunas:

* `especie` (nomes de 4 esp√©cies quaisquer),
* `altura_m` (valores num√©ricos com alturas em metros),
* `florida` (valores l√≥gicos TRUE/FALSE indicando se a planta estava florida).

1. Monte o `data.frame` chamado `plantas`.
2. Calcule a **m√©dia da altura** das plantas.
3. Filtre apenas as plantas floridas.
4. Renomeie a coluna `altura_m` para `altura_media_m`.

```{webr}
plantas <- data.frame()
```

------------------------------------------------------------------------

## üõ†Ô∏è Manipula√ß√£o e transforma√ß√£o de dados ü™õ com dplyr

### Utiliza√ß√£o do  *pipe* `|>`

O [R desde a vers√£o 4.1.0 permite a utiliza√ß√£o do operador `|>`](https://ivelasq.rbind.io/blog/understanding-the-r-pipe/), popularmente chamado de *pipe* (cano, em tradu√ß√£o literal), que permite o encadeamento de a√ß√µes na linguagem.
Isso serve apenas para facilitar a leitura do c√≥digo.
Assim lemos o c√≥digo da esquerda para a direita.  

Por exemplo, usando os exemplos anteriores, poder√≠amos fazer uso do *pipe* da seguinte maneira:

```{webr}
pinguins |> 
  head()
```

```{webr}
pinguins |> 
  tail()
```

```{webr}
pinguins |> 
  glimpse()
```

**Reparem que o resultado √© o mesmo apresentado na @sec-inspecaobasica.**  

O verdadeiro poder do *pipe* `|>`  aparece quando encadeamos m√∫ltiplas opera√ß√µes em sequ√™ncia.
Isso nos permite realizar uma an√°lise completa em poucas linhas de c√≥digo, mantendo a l√≥gica clara.  

#### Exemplo

Vamos filtrar os pinguins da esp√©cie `Adelie`, selecionar a coluna de massa corporal, remover os valores ausentes e, por fim, calcular a m√©dia

Veja como o |> torna essa sequ√™ncia de passos f√°cil de ler:


```{webr}
pinguins |>
  filter(species == "Adelie") |> 
  select(body_mass_g) |> 
  na.omit() |> 
  summarise(media_massa = mean(body_mass_g))
```

::: {.callout-tip}
#### `|>` funciona como um cano!

Pense no `|>` como um cano que 'passa' o resultado do comando anterior para a pr√≥xima fun√ß√£o.
Isso nos permite ler o c√≥digo da esquerda para a direita, como uma sequ√™ncia de passos.
:::

Sem o *pipe*, o mesmo processo seria mais complexo e dif√≠cil de ler, pois uma fun√ß√£o ficaria aninhada dentro da outra:

```{webr}
summarise(
  na.omit(
    select(
      filter(pinguins, species == "Adelie"), 
      body_mass_g)
    ), 
  media_massa = mean(body_mass_g))
```

O `|>` transforma essa sintaxe confusa em uma sequ√™ncia l√≥gica de comandos. 


### Pacote `dplyr` ü™õ

O pacote **dplyr** (parte do [tidyverse](https://tidyverse.org/)) [@dplyr]facilita a manipula√ß√£o de dados com verbos simples e encade√°veis.

```{webr}
# Filtrando dados
dados |>
  filter(amostrado == TRUE)

# Selecionando colunas
dados |>
  select(especie, comprimento)

# Criando novas vari√°veis
dados |>
  mutate(comprimento_cm = comprimento * 10)
```

::: callout-note
#### Operador pipe `|>`
L√™-se ‚Äúent√£o‚Äù. Ele envia o resultado de uma etapa para a pr√≥xima, tornando o c√≥digo mais leg√≠vel.
Por exemplo, leia o c√≥digo abaixo:

```r
dados |> filter(amostrado == TRUE)
```
O significado disso √©:

> ‚Äúpegue `dados`, ent√£o filtre apenas as linhas com `amostrado == TRUE`‚Äù.

:::

#### Fun√ß√µes importantes!

+ `select()`: Escolhe colunas.
+ `filter()`: Filtra linhas.
+ `mutate()`: Cria novas colunas ou altera existentes.
+ `group_by()` e `summarize()`: Agrupa dados para fazer resumos.  

Filtrando pinguins com barbatanas maiores que 200 mm:

```{webr}
pinguins_maior_que_200 <-
  pinguins |>
  filter(flipper_length_mm > 200)
pinguins_maior_que_200
```



#### Sele√ß√£o de colunas - `dplyr::select()`

Podemos selecionar colunas com a fun√ß√£o `select()`:

```{webr}
pinguins |>
  select(flipper_length_mm, body_mass_g)
```

#### Cria√ß√£o de novas colunas - `dplyr::mutate()`

Para criar novas colunas, usamos a fun√ß√£o `mutate()`.

```{webr}
dados_com_nova_coluna <- 
  pinguins |>
  mutate(
    diferenca = flipper_length_mm - bill_length_mm
  )
```

Podemos fazer isso baseados em condi√ß√µes. Por exemplo, a fun√ß√£o `case_when()` √© √≥tima para aplicar v√°rias regras, enquanto o `ifelse()` √© mais simples e ideal para regras de 'se isso, ent√£o aquilo'.  

```{webr}
pinguins |>
  mutate(barbatana_grande = case_when(
    flipper_length_mm > 200 ~ "Grande",
    flipper_length_mm < 200 ~ "Pequena",
    .default = "Sem dados"
  ))
```

```{webr}
pinguins |>
  mutate(
    especie_Adelia = ifelse(species == "Adelia", TRUE, FALSE)
      )
```

#### Agrupamento e sumariza√ß√£o de dados - `group_by()` e `summarise()`

Podemos agrupar os dados por qualquer vari√°vel e fazer sum√°rios estat√≠sticos, √∫teis na an√°lise explorat√≥ria de dados.
Para agrupar os dados, utilizamos a fun√ß√£o `group_by()`; e para sumarizar, utilizamos a fun√ß√£o `summarise()`.  

```{webr}
pinguins |>
  group_by(species) |>
  summarise(
    media_barbatana_mm = mean(flipper_length_mm, na.rm = TRUE),
    n_individuos = n()
  )
```

A fun√ß√£o `summarise()` √© incrivelmente poderosa para resumir seus dados.
Al√©m de calcular a m√©dia (`mean()`), podemos usar v√°rias outras fun√ß√µes estat√≠sticas para obter uma vis√£o mais completa de cada grupo.  

Imagine que queremos entender n√£o apenas a m√©dia, mas tamb√©m a variabilidade dos dados.
Podemos calcular o desvio padr√£o (`sd()`), o valor m√≠nimo (`min()`) e o m√°ximo (`max()`) do comprimento da barbatana por esp√©cie.  


```{webr}
pinguins |>
  group_by(species) |>
  summarise(
    media_barbatana_mm = mean(flipper_length_mm, na.rm = TRUE),
    desvio_padrao_mm = sd(flipper_length_mm, na.rm = TRUE),
    min_barbatana_mm = min(flipper_length_mm, na.rm = TRUE),
    max_barbatana_mm = max(flipper_length_mm, na.rm = TRUE),
    n_individuos = n()
  )
```

::: {.callout-tip}
## `na.rm = TRUE`

O `na.rm = TRUE` que voc√™ v√™ dentro das fun√ß√µes `mean()`, `sd()`, `min()` e `max()` significa 'remova os valores NA (valores ausentes) antes de fazer o c√°lculo'. Isso evita erros e garante que a fun√ß√£o opere apenas com os dados dispon√≠veis.  

:::

#### Mais um exemplo de agrupamentos

Podemos gerar resumos por grupo ‚Äî √∫til em an√°lises ecol√≥gicas, por exemplo.

```{webr}
dados |>
  group_by(amostrado) |>
  summarise(
    media = mean(comprimento),
    desvio = sd(comprimento),
    n = n()
  )
```


#### Simplificando contagens com `count()`

A fun√ß√£o `count()` do pacote `dplyr` √© a maneira mais simples e direta de realizar contagens por grupos.
√â uma ferramenta essencial na an√°lise explorat√≥ria.  

Enquanto `summarise()` pode ser usado para contar, a fun√ß√£o `count()` foi feita para essa tarefa, tornando o c√≥digo mais simples e intuitivo.
Ela automaticamente agrupa os dados e conta a frequ√™ncia de cada categoria.

Por exemplo, se quisermos saber a quantidade de pinguins de cada esp√©cie em cada ilha, basta usar `count()` e especificar as colunas:

```{webr}
pinguins |> 
  count(species, island)
```

√â uma maneira r√°pida e elegante de resumir a distribui√ß√£o dos dados categ√≥ricos.  


## üß© Exerc√≠cios Pr√°ticos ‚Äî Parte II

### 1. Selecionando e filtrando üîç

1. Selecione apenas as colunas `species`, `island` e `body_mass_g` do conjunto `pinguins`.
2. Filtre apenas os pinguins da esp√©cie **Gentoo**.
3. Filtre apenas os pinguins com **massa corporal maior que 5000 g**.
4. Combine as duas condi√ß√µes: mostre apenas pinguins da esp√©cie **Gentoo** com massa **acima de 5000 g**.

```{webr}
pinguins
```

---

### 2. Criando novas colunas ‚öôÔ∏è

1. Crie uma nova coluna chamada `massa_kg`, que converta `body_mass_g` para quilogramas (`massa_kg = body_mass_g / 1000`).
2. Crie uma coluna chamada `barbatana_categoria`, que classifique os pinguins como `"Curta"` se `flipper_length_mm < 190`, `"M√©dia"` se estiver entre 190 e 210, e `"Longa"` se for maior que 210 (use `case_when()`).
3. Mostre apenas as colunas `species`, `flipper_length_mm` e `barbatana_categoria`.

```{webr}
pinguins
```

---

### 3. Agrupando e resumindo üìä

1. Calcule a **m√©dia** da massa corporal (`body_mass_g`) para cada esp√©cie de pinguim.
2. Adicione tamb√©m o **desvio padr√£o** e o **n√∫mero de indiv√≠duos** por esp√©cie.
3. Em seguida, adicione uma segunda camada de agrupamento, calculando esses valores por **esp√©cie e ilha**.

```{webr}
pinguins
```

---

### 4. Contagens r√°pidas com `count()` üî¢

1. Conte quantos indiv√≠duos existem de cada esp√©cie (`species`).
2. Conte quantos indiv√≠duos existem por esp√©cie e sexo (`species`, `sex`).
3. Crie um novo objeto chamado `contagem_isla` com o n√∫mero de pinguins por ilha (`island`), e visualize o resultado ordenado do maior para o menor n√∫mero de registros (use `arrange(desc(n))`).

```{webr}
pinguins
```

---

### 5. Combinando opera√ß√µes em sequ√™ncia üß†

Agora, una v√°rios passos em uma √∫nica sequ√™ncia usando o operador `|>`:

> Filtre apenas os pinguins da esp√©cie *Adelie*, remova valores ausentes, crie uma nova coluna com a massa em kg, e calcule a m√©dia dessa nova coluna.

```{webr}
pinguins
```

---

### 6. Mini-desafio ecol√≥gico üåø

Imagine que cada pinguim representa um indiv√≠duo monitorado em campo.
Use os dados para responder:

1. Qual ilha possui, em m√©dia, os pinguins mais pesados?
2. Qual esp√©cie tem maior varia√ß√£o (desvio padr√£o) no comprimento da barbatana?
3. Crie uma nova vari√°vel `densidade_aprox` definida como `(body_mass_g / flipper_length_mm)`, e mostre a m√©dia dessa vari√°vel por esp√©cie.

```{webr}
pinguins
```


```{r}
#| eval: false
#| echo: false
# Exercicio 6
# 1. Ilha com pinguins mais pesados (m√©dia)
pinguins |>
  group_by(island) |>
  summarise(media_massa = mean(body_mass_g, na.rm = TRUE)) |>
  arrange(desc(media_massa))

# üí° Resultado esperado:

# Biscoe √© a ilha com pinguins mais pesados em m√©dia (~5076 g), seguida de Dream e Torgersen.

# 2. Esp√©cie com maior varia√ß√£o (desvio padr√£o) no comprimento da barbatana
pinguins |>
  group_by(species) |>
  summarise(dp_barbatana = sd(flipper_length_mm, na.rm = TRUE)) |>
  arrange(desc(dp_barbatana))

# üí° Resultado esperado:

# Gentoo tem o maior desvio padr√£o (maior varia√ß√£o) no comprimento da barbatana.

# 3. Densidade aproximada e m√©dia por esp√©cie
pinguins |>
  mutate(densidade_aprox = body_mass_g / flipper_length_mm) |>
  group_by(species) |>
  summarise(media_densidade = mean(densidade_aprox, na.rm = TRUE)) |>
  arrange(desc(media_densidade))

# üí° Resultado esperado:

# Gentoo tende a ter a maior densidade aproximada, seguida de Chinstrap e Adelie.
```


---

### 7. Desafio de s√≠ntese üéØ

Combine tudo o que aprendeu at√© aqui para criar o seguinte relat√≥rio resumido:

> Para cada esp√©cie de pinguim, mostre:
>
> * n√∫mero de indiv√≠duos (`n`),
> * massa corporal m√©dia em kg,
> * comprimento m√©dio e m√°ximo da barbatana (mm).

> Ordene o resultado da maior para a menor massa corporal m√©dia.

```{webr}
pinguins
```

```{r}
#| eval: false
#| echo: false
# 1. Ilha com pinguins mais pesados (m√©dia)
pinguins |>
  group_by(island) |>
  summarise(media_massa = mean(body_mass_g, na.rm = TRUE)) |>
  arrange(desc(media_massa))

# üí° Resultado esperado:

# Biscoe √© a ilha com pinguins mais pesados em m√©dia (~5076 g), seguida de Dream e Torgersen.

# 2. Esp√©cie com maior varia√ß√£o (desvio padr√£o) no comprimento da barbatana
pinguins |>
  group_by(species) |>
  summarise(dp_barbatana = sd(flipper_length_mm, na.rm = TRUE)) |>
  arrange(desc(dp_barbatana))

# üí° Resultado esperado:

# Gentoo tem o maior desvio padr√£o (maior varia√ß√£o) no comprimento da barbatana.

# 3. Densidade aproximada e m√©dia por esp√©cie
pinguins |>
  mutate(densidade_aprox = body_mass_g / flipper_length_mm) |>
  group_by(species) |>
  summarise(media_densidade = mean(densidade_aprox, na.rm = TRUE)) |>
  arrange(desc(media_densidade))

# üí° Resultado esperado:

# Gentoo tende a ter a maior densidade aproximada, seguida de Chinstrap e Adelie.
```



------------------------------------------------------------------------

## üìà Visualiza√ß√£o de dados üìä

<!-- Visualiza√ß√£o (ggplot2) ‚Üí 40 min -->

O pacote `ggplot2` [@Wickham2016] uma "gram√°tica de gr√°ficos", em que voc√™ constr√≥i o gr√°fico em camadas.
As fun√ß√µes b√°sicas do pacote, nesta ordem, s√£o:

+ `ggplot()`: Define os dados e a est√©tica (`aes()`).  

+ `geom_*`: Adiciona as camadas geom√©tricas (pontos: `geom_point()`; barras: `geom_col()`; linhas: `geom_line()`).

Fa√ßamos um histograma do comprimento do bico dos pinguins:

```{webr}
ggplot(pinguins, aes(x = bill_length_mm)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
  labs(title = "Distribui√ß√£o do comprimento de bico de pinguins do arquip√©lago Palmer", x = "Comprimento de bico (mm)", y = "Frequ√™ncia")
```

### Visualizando rela√ß√µes entre vari√°veis

Gr√°fico de dispers√£o entre comprimento de barbatana (`flipper_length_mm`) e massa corporal (`body_mass_g`)

```{webr}
pinguins |> 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(color = "darkblue", alpha = 0.6) +
  labs(title = "Comprimento de barbatana e massa corporal de pinguins do arquip√©lago Palmer", x = "Comprimento de barbatana", y = "Massa corporal")# + geom_smooth(method = "lm", se = FALSE, color = "red")
```

------------------------------------------------------------------------

### Explorando rela√ß√µes complexas

Podemos adicionar mais vari√°veis aos nossos gr√°ficos usando a est√©tica.

+ `color`: Mapeia uma vari√°vel categ√≥rica para a cor.  

+ `facet_wrap()` e `facet_grid()`: Cria sub-gr√°ficos para cada categoria.  

```{webr}
pinguins |> 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point() +
  labs(title = "Comprimento de barbatana e massa corporal por esp√©cie de pinguim ocorrentes no arquip√©lago Palmer", x = "Comprimento de barbatana", y = "Massa corporal")# + geom_smooth(method = "lm", se = FALSE, color = "red")
```

### Gr√°ficos de facetas

As facetas facilitam a visualiza√ß√£o de dados por grupos.
H√° duas fun√ß√µes que produzem as facetas:

+ `facet_wrap()`, quando voc√™ quer visualizar dados por apenas uma vari√°vel;  

+ `facet_grid()`, que deve ser utilizada quando voc√™ quer ver a combina√ß√£o entre duas vari√°veis.  


```{webr}
ggplot(pinguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point() +
  facet_wrap(~species) +
  labs(
    title = "Comprimento de barbatana e massa corporal\npor esp√©cie de pinguim ocorrentes no arquip√©lago Palmer",
    x = "Comprimento de barbatana (mm)",
    y = "Massa corporal (g)")
```


```{webr}
ggplot(pinguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point() +
  facet_grid(species ~ island) +
  labs(
    title = "Comprimento de barbatana e massa corporal\npor esp√©cie de pinguim e ilha ocorrentes no arquip√©lago Palmer",
    x = "Comprimento de barbatana (mm)",
    y = "Massa corporal (g)")
```

### Gr√°fico de barras com `geom_col()`

Al√©m de histogramas e dispers√µes, gr√°ficos de barras s√£o muito √∫teis:

```{webr}
pinguins |> 
  count(species) |> 
  ggplot(aes(x = species, y = n, fill = species)) +
  geom_col() +
  labs(title = "N√∫mero de pinguins por esp√©cie")
```

-----------

## üß© Exerc√≠cios de Visualiza√ß√£o - Parte III

### 1. Histograma customizado üé®

Crie um histograma da vari√°vel `body_mass_g`.
Use uma cor diferente para o preenchimento (`fill`) e outra para o contorno (`color`).
Adicione t√≠tulo e r√≥tulos adequados aos eixos.

```{webr}
# Coloque aqui seu c√≥digo
pinguins
```

---

### 2. Rela√ß√£o entre duas vari√°veis üìà

Fa√ßa um gr√°fico de dispers√£o entre `bill_length_mm` (comprimento do bico) e `bill_depth_mm` (profundidade do bico).
Diferencie as esp√©cies por cor (`color = species`) e use `alpha = 0.6` para dar transpar√™ncia aos pontos.

```{webr}
# Coloque aqui seu c√≥digo
pinguins
```

---

### 3. Comparando grupos com facetas üß©

Mostre o gr√°fico anterior, mas agora adicione facetas por **ilha** usando `facet_wrap(~island)`.
Inclua um t√≠tulo e eixos leg√≠veis.

```{webr}
# Coloque aqui seu c√≥digo
pinguins
```

---

### 4. Gr√°fico de barras empilhadas üß±

Crie um gr√°fico de barras mostrando o n√∫mero de pinguins por **esp√©cie e sexo**.
Use `geom_col(position = "dodge")` para colocar as barras lado a lado.
D√™ um t√≠tulo e personalize as cores com `fill = sex`.

```{webr}
# Coloque aqui seu c√≥digo
pinguins
```


---

## Desafio da oficina

Usando o que voc√™ aprendeu nesses dois dias, crie um pequeno conjunto de dados com **tr√™s esp√©cies vegetais** e **tr√™s vari√°veis quantitativas** (por exemplo: altura, biomassa e √°rea foliar).  

1. Calcule a m√©dia de cada vari√°vel.
2. Crie um gr√°fico simples (de pontos ou colunas) mostrando uma rela√ß√£o entre elas.
3. D√™ um t√≠tulo e r√≥tulos adequados.  


```{webr}
# 1. Calcule a m√©dia de cada vari√°vel.
# 2. Crie um gr√°fico simples (de pontos ou colunas) mostrando uma rela√ß√£o entre elas.
# 3. D√™ um t√≠tulo e r√≥tulos adequados.  
1 + 1 # Insira seu c√≥digo aqui
```

---


## Conclus√£o e pr√≥ximos passos

**Parab√©ns!**
Voc√™ concluiu esta oficina de introdu√ß√£o √† an√°lise explorat√≥ria de dados em R.
Vimos (quase) o ciclo completo da an√°lise de dados: importa√ß√£o, limpeza, transforma√ß√£o e visualiza√ß√£o.  

**Onde seguir a partir daqui?**

+ **Aprofunde-se na linguagem R:** continue explorando os fundamentos da linguagem, fun√ß√µes, estruturas de dados e boas pr√°ticas de programa√ß√£o. H√° vasta literatura introdut√≥ria e intermedi√°ria dispon√≠vel ‚Äî veja, por exemplo, [@VicentiniPerdiz2021].  

+ **Modelagem estat√≠stica:** avance para t√©cnicas de an√°lise inferencial e modelagem, como regress√£o linear, ANOVA, e modelos generalizados, entre outras.  

+ **Comunica√ß√£o e visualiza√ß√£o interativa:** transforme an√°lises em aplica√ß√µes din√¢micas e relat√≥rios interativos com pacotes como {shiny}, {flexdashboard} e {rmarkdown}.  

**Continue praticando** ‚Äî cada nova an√°lise √© uma oportunidade para consolidar o que aprendeu e descobrir novas possibilidades dentro do universo do R!  

*****************

Ao concluir esta oficina, o participante aprendeu a:

* compreender o que √© o R e o ambiente RStudio, seus pain√©is e formas b√°sicas de intera√ß√£o;

* criar, armazenar e manipular objetos e vetores de diferentes tipos (num√©ricos, textuais e l√≥gicos);

* construir e explorar `data.frame`s, acessando linhas e colunas por diferentes m√©todos;

* importar e inspecionar conjuntos de dados (.csv, .xlsx), utilizando fun√ß√µes como `read.table()`, `head()`, `str()` e `summary()`;

* realizar checagem e limpeza de dados, incluindo tratamento de valores ausentes, renomea√ß√£o de colunas e transforma√ß√£o de tipos;

* aplicar os principais verbos do pacote `dplyr` (`select()`, `filter()`, `mutate()`, `group_by()`, `summarise()`, `count()`) para manipula√ß√£o e transforma√ß√£o de dados;

* compreender e utilizar o pipe nativo `|>` para encadear opera√ß√µes de forma leg√≠vel e eficiente;

* efetuar an√°lises explorat√≥rias, incluindo agrupamentos, sumariza√ß√µes e contagens;

* iniciar-se na visualiza√ß√£o de dados por meio do pacote `ggplot2`, criando gr√°ficos b√°sicos para interpreta√ß√£o visual dos resultados.  

---

## Refer√™ncias citadas

::: {#refs}
:::


